<!doctype html><html><head><title>Threading Macros</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/assets/css/bootstrap.min.css><link rel=stylesheet href=/assets/css/layouts/main.css><link rel=stylesheet href=/assets/css/style.css><link rel=stylesheet href=/assets/css/navigators/navbar.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/assets/images/favicon.png><link rel=stylesheet href=/assets/css/style.css><meta name=description content="What are they and how to use them in Clojure"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/assets/css/layouts/single.css><link rel=stylesheet href=/assets/css/navigators/sidebar.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/assets/images/main-logo.png>Kara Kelley</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/assets/images/main-logo.png class=d-none id=main-logo>
<img src=/assets/images/inverted-logo.png class=d-none id=inverted-logo></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><input type=text placeholder=Search data-search id=search-box><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><a href=/posts/fp-oop/>FP & OOP</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/assets/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/kara.jpg><h5 class=author-name>Kara Kelley</h5><p>February 15, 2018</p></div><div class=title><h1>Threading Macros</h1></div><div class=post-content id=post-content><p>It&rsquo;s not even been a week since I&rsquo;ve been programming in Clojure and I kept seeing these funny looking arrows <code>-></code>
in blogs and on StackOverflow. I had a sense in how they worked and decided to use them in my first feature because
I thought they made the code easier to read.</p><p>Come to find out, they are called threading macros. You don&rsquo;t have to use them but they seem to express more clearly
what you are attemping to do with your data structure. They are a way to convert nested functions into a linear flow
of function calls.</p><p>The term <em>thread</em> in this context means to pass a value through a pipeline of functions and is not related to the concept of concurrent threads of execution. Just wanted to get that out there.</p><p>Say we have a nested data structure like so:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure>(<span style=color:#66d9ef>def </span>fake-data
  {<span style=color:#e6db74>:name</span> <span style=color:#e6db74>&#34;Kara Kelley&#34;</span>
   <span style=color:#e6db74>:address</span> {<span style=color:#e6db74>:street</span> <span style=color:#e6db74>&#34;123 nowhere street&#34;</span>
             <span style=color:#e6db74>:city</span> <span style=color:#e6db74>&#34;Chicago&#34;</span>
             <span style=color:#e6db74>:state</span> <span style=color:#e6db74>&#34;Illinois&#34;</span>
             <span style=color:#e6db74>:zip</span> <span style=color:#ae81ff>123456</span>}
    <span style=color:#e6db74>:employer</span> {<span style=color:#e6db74>:name</span> <span style=color:#e6db74>&#34;A place somewhere&#34;</span>
              <span style=color:#e6db74>:address</span> {<span style=color:#e6db74>:street</span> <span style=color:#e6db74>&#34;12345 nowhere avenue&#34;</span>
              <span style=color:#e6db74>:city</span> <span style=color:#e6db74>&#34;Chicago&#34;</span>
              <span style=color:#e6db74>:state</span> <span style=color:#e6db74>&#34;Illinois&#34;</span>
              <span style=color:#e6db74>:zip</span> <span style=color:#ae81ff>123456</span>}}})

</code></pre></div><p>We could get some data like what state the employer is located by doing something like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure>(<span style=color:#e6db74>:city</span> (<span style=color:#e6db74>:address</span> (<span style=color:#e6db74>:employer</span> fake-data)))
<span style=color:#75715e>; Chicago</span>
</code></pre></div><p>You have to start from the inside and work your way to the outside while trying to keep some context of where you started. It&rsquo;s not terrible but it&rsquo;s not super easy to read and we could improve it using thread macros. Let&rsquo;s give that a try.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure>(-&gt; person
    <span style=color:#e6db74>:employer</span>
    <span style=color:#e6db74>:address</span>
    <span style=color:#e6db74>:city</span>)

<span style=color:#75715e>; Chicago</span>
</code></pre></div><p>I think threading macros is even more helpful when you have a value and need to pass that value to a series of functions.
Say we want to perform a calculation and pass the value to each function.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure>(<span style=color:#66d9ef>defn </span>calculate []
  (reduce + (map <span style=color:#f92672>#</span>(* % %) (filter odd? (range <span style=color:#ae81ff>10</span>)))))
<span style=color:#75715e>; 165</span>

</code></pre></div><p>So, if we start from the inside we want a range of 10 numbers, get all the odd numbers, multiply each number by itself, then add them all up. We can follow it but we can do better!</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure>(<span style=color:#66d9ef>defn </span>calculate []
  (<span style=color:#a6e22e>-&gt;&gt;</span> (range <span style=color:#ae81ff>10</span>)
       (filter odd?)
       (map <span style=color:#f92672>#</span>(* % %))
       (reduce +)))
</code></pre></div><p>That&rsquo;s much easier read! So with each step in the pipeline, it takes the result from the previous step as its argument. While they look like function calls with no arguments, starting with the second expression, they in fact all are given one argument which is the result of previously evaluated expression.</p><p>It&rsquo;s also important to note that in each of these two examples I used two different arrows. The first
<code>-></code> is a thread-first macro and <code>->></code> is a thread-last macro. What&rsquo;s the difference?</p><p>With thread-first macros, the threaded argument is inserted in the first position of the argument list. With thread-last macros, the argument is inserted in the last position of the argument list. I wish I had known this 48 hours ago when I couldn&rsquo;t figure out <em>why</em> my arguments were getting out of order. What I actually needed was a thread-last macro instead of a thread-first macro. Well, at least now I know. So, <code>-></code> and <code>->></code> do the same thing but they differ in where the threaded argument is placed in the argument list of the functions.</p></div><div class=btn-improve-page><a href=https://github.com/klkelley/klkelley.github.io/edit/master/content/posts/2018-02-15-threads.markdown><i class="fas fa-code-branch"></i>Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/2018-02-22-macros/ class="btn btn-outline-info"><span><i class="fas fa-chevron-circle-left"></i>Prev</span><br><span>Clojure Macros</span></a></div><div class="col-md-6 next-article"><a href=/posts/2018-02-14-jvm/ class="btn btn-outline-info"><span>Next <i class="fas fa-chevron-circle-right"></i></span><br><span>Java Virtual Machine (JVM)</span></a></div></div><hr></div></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=#about>About</a></li><li class=nav-item><a class=smooth-scroll href=#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>kelley.15@gmail.com</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=#><img src=/assets/images/inverted-logo.png>
Toha</a></div><div class="col-md-4 text-center">© 2020 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/>Powered by
<img src=/assets/images/hugo-logo-wide.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/assets/js/jquery-3.4.1.min.js></script><script src=/assets/js/popper.min.js></script><script src=/assets/js/bootstrap.min.js></script><script src=/assets/js/navbar.js></script><script src=/assets/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/assets/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>