<!doctype html><html><head><title>Clojure Macros</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/assets/css/bootstrap.min.css><link rel=stylesheet href=/assets/css/layouts/main.css><link rel=stylesheet href=/assets/css/style.css><link rel=stylesheet href=/assets/css/navigators/navbar.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/assets/images/favicon.png><link rel=stylesheet href=/assets/css/style.css><meta name=description content="What are they and how to write them in Clojure"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/assets/css/layouts/single.css><link rel=stylesheet href=/assets/css/navigators/sidebar.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/assets/images/main-logo.png>Kara Kelley (they/them)</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/assets/images/main-logo.png class=d-none id=main-logo>
<img src=/assets/images/inverted-logo.png class=d-none id=inverted-logo></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><input type=text placeholder=Search data-search id=search-box><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><a href=/posts/fp-oop/>FP & OOP</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/assets/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/kara.jpg><h5 class=author-name>Kara Kelley</h5><p>February 22, 2018</p></div><div class=title><h1>Clojure Macros</h1></div><div class=post-content id=post-content><p>Macros have somewhat intimidated me as a newbie to Clojure. I didn&rsquo;t
understand why they would be useful and I had a hard time understanding how to write
my own macros (still working on it, to be honest!). So let&rsquo;s talk about macro basics and how to write our own macros.</p><p>Macros in Clojure are a way to do metaprogramming. Metaprogramming is a programming technique in
which computer programs have the ability to treat programs as their data. It means a program can modify
another program or even it&rsquo;s own program. This isn&rsquo;t a blog post about metaprogramming directly but I
thought the relationship was important to note.</p><p>Macros are a way to extend Clojure to suit your specific problem. Macros enable you to do a few things:</p><ol><li>Create and implement your own language features yourself</li><li>Reduce the number of lines of code making it more readable and concise.</li><li>Encapsulate patterns and repetive code by replacing it with a single macro call.</li></ol><p>In fact, if you&rsquo;ve been following along with my blog we just saw an example of a macro already
built into clojure, threading macros. But we&rsquo;re going to look at making our own macros just know that
there are some macros that come built-in to the language.</p><p>Defining a macro looks similar to how you would define a function. It takes an optional
docstring, a vector of arguments, and has a body.</p><p>For some reason I tend to reach for <code>unless</code> when I work in Ruby. I don&rsquo;t have a strong reasoning behind
it except that I just think it&rsquo;s easier to read. <code>unless</code> is an expression that is the opposite of <code>if</code>. Unfortunately, Clojure doesn&rsquo;t
come with <code>unless</code> but good thing we&rsquo;re learning about macros! Let&rsquo;s make our own!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>defmacro </span>unless
</span></span><span style=display:flex><span>  [condition <span style=color:#f92672>&amp;</span> forms]
</span></span><span style=display:flex><span>  <span style=color:#f92672>`</span>(<span style=color:#66d9ef>if </span>(not <span style=color:#f92672>~</span>condition)
</span></span><span style=display:flex><span>    <span style=color:#f92672>~@</span>forms))
</span></span></code></pre></div><p>We can call our new macros like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#a6e22e>unless</span> (= <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>) true false)
</span></span><span style=display:flex><span><span style=color:#75715e>; true </span>
</span></span></code></pre></div><p>We will talk about what each of these lines means so don&rsquo;t fret. The first thing to note is that to
create our own macro we use <code>defmacro</code> to define the macro. Next we have our vector of arguments which are similar to how you would
construct a vector of arguments in a regular function. Where it gets wierd is the last two lines of the function. If you look closely
you can see a backtick being used in front if the <code>if</code> condition. When writing macros in clojure those little backticks are referred to as syntax quoting.</p><p>Syntax quoting returns unevaluated data structures with fully qualified symbols (i.e. the symbol&rsquo;s namespace included). If you want to follow
along feel free to open up your repl. Let&rsquo;s see some examples of syntax quoting.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(+ <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>9</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>; 13</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>`</span>(+ <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>9</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>; (clojure.core/+ 4 9)</span>
</span></span></code></pre></div><p>So when you include use syntax quoting the expression is not evaluated and it is instead treated as a list. Kind of cool if you ask me! There is another type of quoting using <code>'</code> or <code>(quote)</code>. It&rsquo;s similar to syntax quoting but the difference is symbols are not
resolved and you can&rsquo;t unquote them. Which is what we&rsquo;re going to talk about next but I did want to touch on the fact that there
are two ways of quoting.</p><p>Ok so we know about the syntax quoting. What&rsquo;s up with the tilde <code>(~)</code>? When writing macros its referred to as unquoting. Unquoting is how you begin to evaluate expressions. Let&rsquo;s see an example of what I&rsquo;m talking about.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>`</span>(+ <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>9</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>; (clojure.core/+ 4 9)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>`</span>(+ <span style=color:#ae81ff>4</span> <span style=color:#f92672>~</span>(inc <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span><span style=color:#75715e>; (clojure.core/+ 4 3)</span>
</span></span></code></pre></div><p>Once we hit the unquoting then the expression <code>(inc 2)</code> was evaluated. So in our <code>unless</code> macro we unquote (i.e. evaluate) the condition that&rsquo;s
passed in which in our case is <code>(= 1 2)</code>.</p><p>Ok, now to the last funky line with the <code>~@forms</code>. This is referred to as unquote splicing. It&rsquo;s similar to unquote except
that it allows multiple forms to be inserted in place of a single unquote form. It essentially unwraps the data structure and
places the contents within the syntax-quoted data structure. Again, let&rsquo;s see an example.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>`</span>(+ <span style=color:#f92672>~</span>(list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>))
</span></span><span style=display:flex><span><span style=color:#75715e>; (clojure.core/+ (1 2 3))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>`</span>(+ <span style=color:#f92672>~@</span>(list <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>))
</span></span><span style=display:flex><span><span style=color:#75715e>; (clojure.core/+ 1 2 3)</span>
</span></span></code></pre></div><p>So as you can see the unquote splicing unwraps the data structure and places it in the same order. We use unquote splicing
in our <code>unless</code> macro because our macro takes a varying number of arguments which will be represented in a data structure therefore
we must unwrap them otherwise we will get an error.</p><p>I believe understanding the anatomy of macros is important before you can begin to even write them. I underestimated the learning
curve to understanding macros but I think this is a great step in the right direction.</p><p>If you are new to Clojure I would highly recommend <a href=https://www.braveclojure.com/clojure-for-the-brave-and-true/>Clojure for the Brave and True</a> which is explains some concepts rather well and with some humor at times. I&rsquo;d also highly recommend Living
Clojure by Carin Meier.</p></div><div class=btn-improve-page><a href=https://github.com/klkelley/klkelley.github.io/edit/master/content/posts/2018-02-22-macros.markdown><i class="fas fa-code-branch"></i>
Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/2018-02-28-functional/ class="btn btn-outline-info"><span><i class="fas fa-chevron-circle-left"></i> Prev</span><br><span>Functional Programming</span></a></div><div class="col-md-6 next-article"><a href=/posts/2018-02-15-threads/ class="btn btn-outline-info"><span>Next <i class="fas fa-chevron-circle-right"></i></span><br><span>Threading Macros</span></a></div></div><hr></div></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=#about>About</a></li><li class=nav-item><a class=smooth-scroll href=#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>kelley.15@gmail.com</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=#><img src=/assets/images/inverted-logo.png>
Toha</a></div><div class="col-md-4 text-center">© 2020 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/>Powered by
<img src=/assets/images/hugo-logo-wide.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/assets/js/jquery-3.4.1.min.js></script>
<script src=/assets/js/popper.min.js></script>
<script src=/assets/js/bootstrap.min.js></script>
<script src=/assets/js/navbar.js></script>
<script src=/assets/js/main.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/assets/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>