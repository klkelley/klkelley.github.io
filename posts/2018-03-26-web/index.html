<!doctype html><html><head><title>Web Abstractions</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/assets/css/bootstrap.min.css><link rel=stylesheet href=/assets/css/layouts/main.css><link rel=stylesheet href=/assets/css/style.css><link rel=stylesheet href=/assets/css/navigators/navbar.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/assets/images/favicon.png><link rel=stylesheet href=/assets/css/style.css><meta name=description content="Web abstractions in Ruby, Java, and Clojure"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/assets/css/layouts/single.css><link rel=stylesheet href=/assets/css/navigators/sidebar.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/assets/images/main-logo.png>Kara Kelley</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/assets/images/main-logo.png class=d-none id=main-logo>
<img src=/assets/images/inverted-logo.png class=d-none id=inverted-logo></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><input type=text placeholder=Search data-search id=search-box><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><a href=/posts/fp-oop/>FP & OOP</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/assets/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/kara.jpg><h5 class=author-name>Kara Kelley</h5><p>March 26, 2018</p></div><div class=title><h1>Web Abstractions</h1></div><div class=post-content id=post-content><p>This post will be mostly focused on web abstractions in Ruby, Java, and Clojure. All of these languages have
web application libraries that abstract the details of HTTP into a simple, unified API. The goal
of these libraries is to provide a minimal API for connecting web servers (i.e. WEBrick) and web frameworks (i.e. Rails, Sinatra). There are other languages that also have similar web abstractions but I&rsquo;m mostly going to be focusing on these languages specifically.</p><h3 id=rack>Rack</h3><p>I&rsquo;ve worked with both Rails and Sinatra and remember hearing about Rack occasionally when I first started
learning the frameworks. It turns out, Rails (and Sinatra) are built on top of Rack or have a Rack interface
for allowing web servers to connect to them.</p><p>Rack is a Ruby package that provides an easy-to-use interface to the Ruby <a href=http://ruby-doc.org/stdlib-2.2.0/libdoc/net/http/rdoc/Net/HTTP.html>Net::HTTP</a> library. Put simply, it allows you to easily deal with HTTP requests.</p><p>We know that HTTP protocol describes the activity of a client sending an HTTP request to a server and the
server returning a response. Both the request and the response have similar structures consisting of a status line, headers, and an optional body.</p><p>Rack is similar. It&rsquo;s a Ruby object that has a call method which has a single argument, the environment which corresponds to a HTTP request, and returns an array of 3 elements: status, headers, and a body.</p><p>Rack includes handlers that connect Rack to web servers like WEBrick and it includes adapters that connect Rack to various web frameworks like Rails and Sinatra.</p><p>Rack compliant code must have the following three characteristics:</p><ul><li>It must respond to <code>call</code></li><li>The <code>call</code> method must accept a single argument which is typically called <code>env</code> and it bundles up all of the data about the request</li><li>The <code>call</code> method must return an array of three elements (status, headers, and body)</li></ul><p>The environment argument that I&rsquo;ve been referring to is a hash that consists of the request method, request path, server name, server port, and query string among some other optional information.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span>require <span style=color:#e6db74>&#39;rack&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RequestHandler</span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>call</span>(env)
</span></span><span style=display:flex><span>    <span style=color:#f92672>[</span><span style=color:#ae81ff>200</span>, { <span style=color:#e6db74>&#34;Content-Type&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;text/plain&#34;</span>}, <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;Hello World&#34;</span><span style=color:#f92672>]]</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>Rack</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Handler</span><span style=color:#f92672>::</span><span style=color:#66d9ef>WEBrick</span><span style=color:#f92672>.</span>run(<span style=color:#66d9ef>RequestHandler</span><span style=color:#f92672>.</span>new, <span style=color:#e6db74>:port</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>8080</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># instantiate the RequestHandler and tell Rack we want to use port 8080</span>
</span></span></code></pre></div><p>In the above example when we instantiate <code>RequestHandler</code>, call <code>run</code>, and visit <code>localhost:8080</code> we would see Hello World. Pretty cool!</p><h3 id=ring>Ring</h3><p>Clojure&rsquo;s ring is very similar to Rack, in fact, it was inspired by Ruby&rsquo;s Rack and
Pythons WSGI. A web application developed for Ring consists of: Handlers, Requests, Responses, and Middleware.</p><p><strong>Handlers</strong></p><p>Handlers are functions that define your web app. They take one argument (similar to <code>call</code> taking <code>env</code> in Rack) which represents the HTTP request and returns a map representing an HTTP response. Here is a basic example.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>test [request]
</span></span><span style=display:flex><span>  {<span style=color:#e6db74>:status</span> <span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:headers</span> {<span style=color:#e6db74>&#34;Content-Type&#34;</span> <span style=color:#e6db74>&#34;text-plain&#34;</span>}
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:body</span> <span style=color:#e6db74>&#34;hello world&#34;</span>})
</span></span></code></pre></div><p><strong>Requests</strong></p><p>As we mentioned, HTTP requests in Ring are represented by maps. There are some keys
that will always exist. Here are some of the standard keys:</p><ul><li><code>:server-port</code> - The port on which the request is being handled</li><li><code>:server-name</code> - The resolved server name, or the server IP address</li><li><code>:remote-addr</code> - The IP address of the client or last proxy that sent the request</li><li><code>:uri</code> - The request URI (the full path after the domain name)</li><li><code>:scheme</code> - The transport protocol, either http or https</li><li><code>:request-method</code> - HTTP request method (i.e. GET, POST, etc.)</li><li><code>:headers</code> - A map consisting of name name string and their value</li><li><code>:body</code> - An InputStream for the request body if it&rsquo;s present</li></ul><p><strong>Responses</strong></p><p>The response map is created by the handler and contain only three keys:</p><ul><li><code>:status</code> - The HTTP Status Code (i.e. 200, 400, 404, etc.)</li><li><code>:headers</code> - A map of HTTP header names and header values</li><li><code>:body</code> - A representation of the body (i.e. String, File, ISeq, or InputStream)</li></ul><p><strong>Middleware</strong></p><p>Middleware are higher-level functions that add functionality to handlers. The first argument of a middleware function should be a handler and the return value should be a new handler function that will call the initial handler.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>wrap-content-type [handler content-type]
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>fn </span>[request]
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>let </span>[response (<span style=color:#a6e22e>handler</span> request)]
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>assoc-in</span> response [<span style=color:#e6db74>:headers</span> <span style=color:#e6db74>&#34;Content-Type&#34;</span>] content-type))))
</span></span></code></pre></div><p>This function adds a content-type headers to every response generated by the handler. Below, we can create a new handler called <code>app</code> which consists of a handler <code>file-handler</code> with the <code>wrap-content-type</code> middleware.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>def </span>app
</span></span><span style=display:flex><span>  (-&gt; file-handler 
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>wrap-content-type</span>)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>wrap-params</span>)))
</span></span></code></pre></div><h3 id=servlet>Servlet</h3><p>This is a basic diagram of servlets in relation to a web application.</p><p><img src=https://www.tutorialspoint.com/servlets/images/servlet-arch.jpg alt=servlet></p><p>Java Servlets are similar to Rack and Ring. A Servlet is a class that handles requests, processes them, and reply back with a response. Servlets are under the control of another Java application called a Servlet Container. When an application receives a request, the Server hands the request to the Servlet Container which then passes it to the target Servlet.</p><p>There are five methods in the Servlet interface:</p><ul><li><code>init()</code> - Initializes the servlet. It is the life cycle method of the servlet and is invoked by the container only once.</li><li><code>service(ServletRequest request, ServletResponse response)</code> - This method is called to process the HTTP request. It determines the kind of request being made and dispatches it to an appropriate method to handle the request. This method It is invoked at each request by the container.</li><li><code>destroy()</code> - It is invoked only once and indicates the servlet is being destroyed</li><li><code>getServletInto()</code> - Returns information about servlet such as writer, copyright, version, etc.</li></ul><h3 id=conclusion>Conclusion</h3><p>To my surprise, these web abstraction libraries aren&rsquo;t as large and complex as I initially assumed. Each of these web abstraction libraries have very small interfaces and are rather simple from a high level view.</p></div><div class=btn-improve-page><a href=https://github.com/klkelley/klkelley.github.io/edit/master/content/posts/2018-03-26-web.markdown><i class="fas fa-code-branch"></i>
Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/2018-03-28-package/ class="btn btn-outline-info"><span><i class="fas fa-chevron-circle-left"></i> Prev</span><br><span>Package Principles</span></a></div><div class="col-md-6 next-article"><a href=/posts/2018-03-20-classpath/ class="btn btn-outline-info"><span>Next <i class="fas fa-chevron-circle-right"></i></span><br><span>Java Classpath</span></a></div></div><hr></div></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#rack>Rack</a></li><li><a href=#ring>Ring</a></li><li><a href=#servlet>Servlet</a></li><li><a href=#conclusion>Conclusion</a></li></ul></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=#about>About</a></li><li class=nav-item><a class=smooth-scroll href=#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>kelley.15@gmail.com</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=#><img src=/assets/images/inverted-logo.png>
Toha</a></div><div class="col-md-4 text-center">Â© 2020 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/>Powered by
<img src=/assets/images/hugo-logo-wide.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/assets/js/jquery-3.4.1.min.js></script>
<script src=/assets/js/popper.min.js></script>
<script src=/assets/js/bootstrap.min.js></script>
<script src=/assets/js/navbar.js></script>
<script src=/assets/js/main.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/assets/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>