<!doctype html><html><head><title>Proxy Pattern</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/assets/css/bootstrap.min.css><link rel=stylesheet href=/assets/css/layouts/main.css><link rel=stylesheet href=/assets/css/style.css><link rel=stylesheet href=/assets/css/navigators/navbar.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/assets/images/favicon.png><link rel=stylesheet href=/assets/css/style.css><meta name=description content="Working with the Proxy Pattern"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/assets/css/layouts/single.css><link rel=stylesheet href=/assets/css/navigators/sidebar.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/assets/images/main-logo.png>Kara Kelley</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/assets/images/main-logo.png class=d-none id=main-logo>
<img src=/assets/images/inverted-logo.png class=d-none id=inverted-logo></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><input type=text placeholder=Search data-search id=search-box><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><a href=/posts/fp-oop/>FP & OOP</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/assets/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/kara.jpg><h5 class=author-name>Kara Kelley</h5><p>April 3, 2018</p></div><div class=title><h1>Proxy Pattern</h1></div><div class=post-content id=post-content><p>Last week one of my mentors suggested that I use the proxy pattern to help me design
a particular feature of my HTTP server. I always get really excited when I can learn and apply
a new design pattern or principle. This particular principle helped me solve an interesting issue
however I felt the use cases I was coming across online for the pattern were rather weak which confused me as to how this
particular pattern was going to help me. So we&rsquo;ll talk about the proxy pattern and how you can use
it in a non-contrived example. We&rsquo;ll also talk a little bit about memoization.</p><p>The proxy pattern provided in the Gang of Four book states:</p><blockquote><p>Allows for object level access control by acting as a pass through entity
or a placeholder object.</p></blockquote><p>Or put more simply, a proxy is a class functioning as an interface to something else. It acts
as a wrapper object that is being called by the client to access the real serving object behind the
scenes. The typical diagram to represent the proxy pattern looks like this:</p><p><img src=https://upload.wikimedia.org/wikipedia/commons/thumb/7/75/Proxy_pattern_diagram.svg/439px-Proxy_pattern_diagram.svg.png alt=proxy></p><h4 id=types-of-proxies><strong>Types of Proxies</strong></h4><p><strong>Remote Proxy:</strong>
The remote proxy is used to represent an object located remotely, usually via a network connection. The local object is a proxy for the remote object. When a method is
invoked on the the local object, it results in a method
being invoked on the remote object. The best example of this type of proxy is an ATM machine. The ATM machine holds proxy objects for bank information that exists in
a remote server.</p><p><strong>Virtual Proxy:</strong>
Virtual proxies are used commonly to delay the creation
and initialization of expensive objects until needed. The
most common example of the virtual proxy is delaying the displaying of images until absolutely necessary. These proxies can also be used to provide some default result
while the actual result is being produced.</p><p><strong>Smart Proxy:</strong>
It can be used to provide an additional layer of security
by interposing additional actions when an object is accessed. An example would be counting the number of times
an object has been accessed and denying access if a certain
number has been reached.</p><p><strong>Protective Proxy:</strong>
It is mainly used to control access rights to an object.
It acts as an authorization layer to verify whether the
user has access to certain content. The proxy checks
whether the caller has the access permissions required
prior to forwarding the request. A common example of
this is when a company uses a proxy server which restricts
certain websites. Only the websites and contents which are
valid will be allowed and the rest will be blocked.</p><p>When I first read about the pattern and saw similar diagrams I understood the idea of relying
on the interface and thought it looked very similar to some other patterns I&rsquo;ve read about like the Decorator pattern. What I still wondered about was what was the point of going through one object to get to another. What problem does that solve? No matter what, <em>eventually</em> you would need to check if the file existed on the server, right? How does using a &ldquo;pass through&rdquo; object solve anything?</p><p>Well, it turns out, using the proxy pattern in conjunction
with caching is pretty common. Using the proxy pattern and caching results would allow me to
avoid hitting IO every single time. Let&rsquo;s take a look at some code.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PublicDirectory</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>PublicDirectory</span><span style=color:#f92672>(</span>String path<span style=color:#f92672>,</span> FileFinder fileFinderCache<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fileFinderCache</span> <span style=color:#f92672>=</span> fileFinderCache<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>documentRoot</span> <span style=color:#f92672>=</span> Paths<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>path<span style=color:#f92672>).</span><span style=color:#a6e22e>toFile</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>path</span> <span style=color:#f92672>=</span> path<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// .. 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>resourceExists</span><span style=color:#f92672>(</span>String path<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> fileFinderCache<span style=color:#f92672>.</span><span style=color:#a6e22e>resourceExists</span><span style=color:#f92672>(</span>documentRoot<span style=color:#f92672>+</span>path<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>The <code>PublicDirectory</code> class takes an instance of
<code>FileFinderCache</code> which is the <strong>proxy</strong> class. When asked if a resource exists,
it will delegate to the proxy (<code>fileFinderCache</code>).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FileFinderCache</span> <span style=color:#66d9ef>implements</span> FileFinder <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> FileFinder fileFinder<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Boolean<span style=color:#f92672>&gt;</span> cache <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>FileFinderCache</span><span style=color:#f92672>(</span>FileFinder fileFinder<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fileFinder</span> <span style=color:#f92672>=</span> fileFinder<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>resourceExists</span><span style=color:#f92672>(</span>String path<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Boolean requestedFiles <span style=color:#f92672>=</span> cache<span style=color:#f92672>.</span><span style=color:#a6e22e>getOrDefault</span><span style=color:#f92672>(</span>path<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>requestedFiles <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      cache<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>path<span style=color:#f92672>,</span> fileFinder<span style=color:#f92672>.</span><span style=color:#a6e22e>resourceExists</span><span style=color:#f92672>(</span>path<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> cache<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>path<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RealFileFinder</span> <span style=color:#66d9ef>implements</span> FileFinder <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>resourceExists</span><span style=color:#f92672>(</span>String path<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    File resource <span style=color:#f92672>=</span> Paths<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>path<span style=color:#f92672>).</span><span style=color:#a6e22e>toFile</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>resource<span style=color:#f92672>.</span><span style=color:#a6e22e>exists</span><span style=color:#f92672>())</span> <span style=color:#f92672>&amp;&amp;</span> resource<span style=color:#f92672>.</span><span style=color:#a6e22e>isDirectory</span><span style=color:#f92672>()</span> <span style=color:#f92672>||</span> resource<span style=color:#f92672>.</span><span style=color:#a6e22e>isFile</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><code>FileFinderCache</code> in turns takes an instance of <code>FileFinder</code> which is our <strong>real subject</strong>
(refer to diagram above for reference). The interesting part comes into play is if a
requested file hasn&rsquo;t been requested before, we&rsquo;ll add the path to our HashMap and ask
our <code>RealFileFinder</code> to see if the resource exists. This means, on subsequent calls, the answer
(in this case a boolean) will be stored in our HashMap which means we don&rsquo;t need to ask
<code>RealFileFinder</code> to do any heavy lifting, resulting in less hits to the IO.</p><p>Prior to applying this pattern, I was going straight to the IO to see if a resource existed
even it had been requested 30 seconds ago. Do we eventually have to hit IO to see if a resource
exists? Yes. Do we have to do it every time for that same resource? No. It&rsquo;s a one and done.</p><p>The downfalls of caching could be that when we create a new resource via a <code>POST</code> request
(which requires to see if that resource exists before creating it) we will be caching that
result right before potentially creating the resource. This means an immediate
<code>GET</code> request for that resource could result in a <code>404 Not Found</code>. A workaround might involve
clearing the cache periodically or bypassing the proxy for <code>POST</code> requests. This something that
I&rsquo;ll likely have to explore in the future.</p></div><div class=btn-improve-page><a href=https://github.com/klkelley/klkelley.github.io/edit/master/content/posts/2018-04-03-proxy.markdown><i class="fas fa-code-branch"></i>
Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/2018-04-05-title/ class="btn btn-outline-info"><span><i class="fas fa-chevron-circle-left"></i> Prev</span><br><span>Composite Pattern</span></a></div><div class="col-md-6 next-article"><a href=/posts/2018-03-28-package/ class="btn btn-outline-info"><span>Next <i class="fas fa-chevron-circle-right"></i></span><br><span>Package Principles</span></a></div></div><hr></div></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#types-of-proxies><strong>Types of Proxies</strong></a></li></ul></li></ul></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=#about>About</a></li><li class=nav-item><a class=smooth-scroll href=#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>kelley.15@gmail.com</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=#><img src=/assets/images/inverted-logo.png>
Toha</a></div><div class="col-md-4 text-center">© 2020 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/>Powered by
<img src=/assets/images/hugo-logo-wide.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/assets/js/jquery-3.4.1.min.js></script>
<script src=/assets/js/popper.min.js></script>
<script src=/assets/js/bootstrap.min.js></script>
<script src=/assets/js/navbar.js></script>
<script src=/assets/js/main.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/assets/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>